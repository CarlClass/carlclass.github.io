---
title: 性能之巅（一）第一章
tags:
  - 笔记
  - 性能之巅
date: 2024-05-29 23:02:53
---


# 性能之巅

## 目的

学习性能相关理论知识，通过性能反向推荐代码质量

## 第一章 绪论

### 学习目标

- 理解系统的性能、人员、活动和挑战

- 理解观测和实验的工具之间的区别

- 对性能观测有一个基本的了解：统计、刨析、火焰图、跟踪、静态观测和动态观测

- 了解方法的作用和Linux的60秒检查表

*通过学习目标，初步认为本章将性能定义，以及如何观测衡量相关指标，如果指标有定义的话，和具体实施的方法论。*

### 1.1 系统性能

范围

- 硬件组件

- 软件组件

全栈：应用程序到硬件的整个软件栈，包括系统库、内核、硬件本身

### 1.2 人员

参与性能分析的人员，角色不同聚焦的领域不同，如网络团队检查网络等等。

### 1.3 活动

软件项目生命周期理想步骤

1. 对未来的产品设置新能目标和建立性能模型
2. 基于软件或硬件原型进行性能特征归纳
3. 在测试环境中对正在开发的产品进行性能分析
4. 对新版本产品做非回归性测试
5. 针对软件发布版本的基准测试
6. 目标生产环境中的概念验证测试
7. 生产环境中的性能调优
8. 检测生产环境中运行的软件
9. 生产环境中的问题的性能分析
10. 对生产环境中的问题做事故回顾
11. 开发性能工具以加强生产环境分析

#### 概念验证测试

TODO增加概念描述

***金丝雀测试***

单个实例上测试新软件，其功能负载仅为生产环境工作负载的一小部分

***蓝绿部署***

流量逐渐转移到一个新的实例池，同时让旧的实例池在线作为备份

#### 容量规划

一系列事前行动。研究开发资源占有=>监控生产资源占用

### 1.4 视角

审视性能是可以从不同视角进行。

视角1：*负载分析*

时间2：*资源分析*

### 1.5 挑战

**主观性**

需要将主管性能指标客观化

**复杂性**

- 分析起点未知
- 连锁故障
- 瓶颈互联
- 负载复杂性

**多原因**

性能问题可能由多个原因促成。

**多个性能问题**

多个性能问题堆积，需要分辨出哪些重要。需要量化问题重要程度。eg:延时

### 1.6 延时

测量用于等待的时间。代指范围广，具体分析时要限定术语。

### 1.7 可观测性

通过观测来理解一个系统，并对完成这一任务的工具进行分类。

*计数器* *剖析* *跟踪*

**计数器、统计数据和指标**

程序或内核提供关于其状态和活动的数据：操作计数，字节计数，延时测量，资源使用率，错误率。通过*计数器*实现。

统计数据：在不同时间读取计数器，计算统计结果。eg : 比率，平均值，百分比

指标：评估或监测一个目标选择的统计数据。

**剖析**

使用工具进行采样，取一个测量的子集（样本）来描绘目标的粗略情况。

火焰图：CPU剖析可视化形式。

**跟踪**

基于事件的记录，捕获事件数据并保存起来以供以后分析

*静态检测*：添加至源代码中硬编码的软件检测点。

*动态检测*：软件运行中，通过内存指令插入检测程序来创建检测点。

*BPF*： Berkeley Packet Filter，Linux动态跟踪工具。

### 1.8 实验

实验工具：大多是基准测试工具。

使用观测和实验解决性能问题

### 1.9 云计算

按需部署计算资源的方式。

性能隔离会带来性能影响

### 1.10 方法

将系统性能领域执行各种任务的建议步骤记录袭来的方式。

**Linux性能分析60秒**

| 工具              | 检查                                                         |
| ----------------- | ------------------------------------------------------------ |
| uptime            | 平均负载可识别负载的增加或减少                               |
| dmesg -T \|tail   | 包括OOM事件的内核错误                                        |
| vmstat -SM 1      | 系统级统计：运行队列长度，交换，CPU总体使用情况              |
| mpstat -P ALL1    | CPU平衡情况：单个CPU繁忙，以为线程扩展性糟糕                 |
| pidstat 1         | 每个进程的CPU使用情况：识别意外的CPU消费者，以及每个进程的用户/系统CPU时间 |
| iostat -sxz 1     | 磁盘I/O统计：IOPS和吞吐量，平均等待时间，忙碌百分比          |
| free -m           | 内存使用情况，包括文件系统的缓存                             |
| sar -n DEV 1      | 网络设备I/O：数据包和吞吐量                                  |
| sar -n TCP,ETCP 1 | TCP统计：连接率、重传                                        |
| top               | 检查概览                                                     |





